<div class="container mt-5">
  <div class="row detail">
    <div class="col-lg-8 col-md-8 main-content">



      <div class="detail-title">

        <p style="line-height: 125%;"><span style="transform: translateY(-4px);"
            class="mr-3 d-inline-block detail-category">
            <a href="/category/{{data.post.category_id}}">
              <span>{{data.post.category_name}}</span>
            </a>
          </span>{{data.post.post_title}}</p>
      </div>
      <div class="header-post-detail">

        <div class="detail-tag align-self-center">#Tags:
          {{#each data.tags}}
          <a href="/tag/{{this.tag_id}}"><span>{{this.tag_name}}</span></a>
          {{/each}}
        </div>
        <div class="mt-4 align-self-center"><b>Ngày đăng:</b>
          <span style="opacity: 0.7;">{{data.post.published_date}}</span>
        </div>
      </div>


      <div class="image-cover">
        <img src="/media/images/posts/{{data.post.post_avatar_image}}" alt="{{data.post.post_title}}">
      </div>



      <div class="detail-content">
        <p>{{{data.post.post_content}}}
        </p>
      </div>
      <div class="form-comment">

        <form class=" clearfix">
          <div class="form-group">
            <label class="title-relative" for="txtComment">Ý kiến của bạn</label>
            <textarea id="cmt" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
          </div>
          <button id="commentBtn" type="submit" class="btn btn-primary float-right">Bình luận</button>
        </form>




      </div>
      <div class="list-comment mt-5">
        <label class="title-relative" for="txtComment">Bình luận</label>
        <div id="comment-list">
          {{#each data.comments}}
          <div class="mt-3">
            <div class="comment-title d-flex justify-content-between">
              <div class="comment-author">{{this.user_fullname}}</div>
              <div class="comment-day">{{this.comment_date}}</div>
            </div>
            <div class="comment ml-3 mt-2">

              <div class="comment-content">
                <p>{{this.comment_content}}</p>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </div>
    <div id="right-cont" style="overflow: hidden;" class="col-lg-4 col-md-4 post-relative pr-4">
      <div style="margin-left: 0px !important;" class="row title-relative">
        <span>Cùng chuyên mục</span>
      </div>
      {{#each data.tenPostsFromCatId}}
      <div class="item-top-10">
        <a href="/post/{{this.post_id}}">
          <div class=" row">
            <div class="col-md-6">
              <div class="image-item">
                <img src="/media/images/posts/{{this.post_avatar_image}}" alt="{{this.post_title}}">
              </div>
            </div>
            <div class="col-md-6">
              <div class="item-topic">
                <span class="topic">{{this.category_name}}</span>
              </div>
              <div class="item-title">
                <span class="title">{{this.post_title}}</span>
              </div>
              <div class="item-day">
                <span class="day"><strong>Ngày đăng:</strong> <i class="date-post">{{this.published_date}}</i></span>
              </div>
            </div>
          </div>
        </a>
      </div>
      {{/each}}
      {{!-- <div class="item-top-10">
                <a href="/post/post_sample">
                    <div class=" row">
                        <div class="col-md-6">
                            <div class="image-item">
                                <img src="/media/images/cn-1.jpg" alt="">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="item-topic">
                                <span class="topic">KINH TẾ</span>
                            </div>
                            <div class="item-title">
                                <span class="title">Doanh nghiệp phải tích cực đổi mới công nghệ</span>
                            </div>
                            <div class="item-day">
                                <span class="day"><strong>Ngày đăng:</strong> <i class="date-post">22-4-2019</i></span>
                            </div>
                        </div>
                    </div>
                </a>
            </div> --}}

    </div>
  </div>

</div>
<script>

  document.getElementById('commentBtn').addEventListener('click', function comment(e) {
    e.preventDefault();

    let content = document.getElementById('cmt').value
    let post_id = window.location.pathname.split('/')[2];
    var http = new XMLHttpRequest();
    var url = '/comment/insert';
    var params = `content=${content}&post_id="${post_id}"`;
    http.open('POST', url, true);

    //Send the proper header information along with the request
    http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

    http.onreadystatechange = function () {//Call a function when the state changes.
      if (http.readyState == 4 && http.status == 200) {
        let user = http.response.user
        let date = new Date();
        let html = `<div class="mt-3">
                    <div class="comment-title d-flex justify-content-between">
                        <div class="comment-author">${JSON.parse(http.response).user}</div>
                        <div class="comment-day">${date.getDate()}-${date.getMonth()}-${date.getFullYear()}</div>
                    </div>
                    <div class="comment ml-3 mt-2">

                        <div class="comment-content">
                            <p>${content}</p>
                        </div>
                    </div>
                </div>`
        document.getElementById('comment-list').insertAdjacentHTML("afterbegin", html);
        document.getElementById('cmt').value = ""
      } else if (http.status == 500) {
        swal.fire({
          type: 'error',
          title: 'Oops!',
          text: JSON.parse(http.response).error,

        }).then((res) => {
          if (res.value) {
            window.location.href = "/sign-in";
          }
        })
      }
    }
    http.send(params);
  })

</script>
